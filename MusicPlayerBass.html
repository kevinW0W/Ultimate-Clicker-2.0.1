<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Bass Booster Pro | Secure</title>
    <style>
        :root {
            --primary: #00e5ff;
            --bg: #0b0f1a;
            --card: #161b2e;
            --text: #f8fafc;
            --accent: #2d3748;
            --success: #10b981;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* --- Verification Screen --- */
        #shield-screen {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .captcha-widget {
            background: #f9f9f9;
            border: 1px solid #d3d3d3;
            border-radius: 3px;
            width: 300px;
            height: 74px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .captcha-widget:hover { background: #f1f1f1; }

        .checkbox-container {
            width: 28px;
            height: 28px;
            border: 2px solid #c1c1c1;
            border-radius: 2px;
            background: white;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #4d90fe;
            border-top: 3px solid transparent;
            border-radius: 50%;
            display: none;
            animation: spin 0.8s linear infinite;
        }

        .checkmark {
            width: 22px;
            height: 22px;
            fill: var(--success);
            display: none;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .captcha-text {
            color: #333;
            font-size: 14px;
            font-family: Roboto, Arial, sans-serif;
            flex-grow: 1;
        }

        .captcha-logo {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #555;
            font-size: 8px;
        }

        /* --- Player UI --- */
        .player-card {
            background: var(--card);
            width: 95%;
            max-width: 800px;
            height: 500px;
            border-radius: 24px;
            display: none; /* Hidden until verified */
            flex-direction: row;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .sidebar {
            width: 240px;
            background: rgba(0,0,0,0.2);
            border-right: 1px solid var(--accent);
            padding: 20px;
            overflow-y: auto;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .viz-circle {
            width: 160px;
            height: 160px;
            margin: 0 auto;
            border-radius: 50%;
            background: #000;
            border: 4px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.05s ease-out;
            box-shadow: 0 0 30px rgba(0, 229, 255, 0.1);
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .btn {
            background: var(--accent);
            border: none;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn-play {
            width: 70px;
            height: 70px;
            background: var(--primary);
            color: var(--bg);
            font-size: 1.5rem;
        }

        .slider-group {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type=range] {
            width: 100%;
            height: 6px;
            background: var(--accent);
            border-radius: 3px;
            appearance: none;
            outline: none;
        }

        input[type=range]::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--primary);
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--accent);
            position: relative;
            border-radius: 2px;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            width: 0%;
            border-radius: 2px;
        }

        .song-item {
            padding: 10px;
            font-size: 0.8rem;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .song-item.active { background: rgba(0, 229, 255, 0.1); color: var(--primary); }
    </style>
</head>
<body>

    <!-- VERIFICATION SCREEN -->
    <div id="shield-screen">
        <div class="captcha-widget" onclick="handleVerify()">
            <div class="checkbox-container" id="cap-box">
                <div class="spinner" id="cap-spinner"></div>
                <svg class="checkmark" id="cap-check" viewBox="0 0 24 24">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
            </div>
            <div class="captcha-text">I'm not a robot</div>
            <div class="captcha-logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#4d90fe"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z"/></svg>
                <span>reCAPTCHA</span>
                <span style="font-size: 6px">Privacy - Terms</span>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div class="player-card" id="app-root">
        <div class="sidebar">
            <button class="btn" style="width: 100%; border-radius: 8px; font-size: 0.7rem; height: 40px; margin-bottom: 20px;" onclick="document.getElementById('f-upload').click()">+ IMPORT MUSIC</button>
            <div id="playlist-container"></div>
        </div>

        <div class="main-content">
            <div class="viz-circle" id="viz-disk">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="var(--primary)"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z"/></svg>
            </div>

            <div style="text-align: center;">
                <h2 id="track-name" style="margin: 0; font-size: 1.2rem; color: var(--primary);">READY FOR INPUT</h2>
                <p id="track-artist" style="color: #64748b; margin: 5px 0; font-size: 0.8rem;">Upload a track to boost the bass</p>
            </div>

            <div class="progress-bar" onclick="seek(event)">
                <div class="progress-fill" id="progress-fill"></div>
            </div>

            <div class="controls">
                <button class="btn" onclick="prev()">⏮</button>
                <button class="btn btn-play" id="play-btn" onclick="togglePlay()">▶</button>
                <button class="btn" onclick="next()">⏭</button>
            </div>

            <div class="booster-controls">
                <div class="slider-group">
                    <div class="slider-label">
                        <span>Bass Impact (55Hz Peak)</span>
                        <span id="bass-val" style="color: var(--primary)">0%</span>
                    </div>
                    <input type="range" min="0" max="100" value="0" oninput="updateBass(this.value)">
                </div>
                <div class="slider-group">
                    <div class="slider-label">
                        <span>Master Output</span>
                        <span id="vol-val" style="color: var(--primary)">100%</span>
                    </div>
                    <input type="range" min="0" max="150" value="100" oninput="updateVol(this.value)">
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="f-upload" multiple accept="audio/*" style="display:none" onchange="handleFiles(event)">

    <script>
        // --- VERIFICATION LOGIC ---
        let isVerified = false;
        function handleVerify() {
            if(isVerified) return;
            const box = document.getElementById('cap-box');
            const spinner = document.getElementById('cap-spinner');
            const check = document.getElementById('cap-check');
            
            box.style.border = 'none';
            spinner.style.display = 'block';

            // Simulate "Human Analysis"
            setTimeout(() => {
                spinner.style.display = 'none';
                check.style.display = 'block';
                isVerified = true;
                
                setTimeout(() => {
                    document.getElementById('shield-screen').style.display = 'none';
                    document.getElementById('app-root').style.display = 'flex';
                    initAudio();
                }, 600);
            }, 1800);
        }

        // --- AUDIO ENGINE ---
        let audioCtx, audio, source, bassShelf, bassPeak, gainNode, compressor, playlist = [], currentIndex = -1;

        function initAudio() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            audio = new Audio();
            source = audioCtx.createMediaElementSource(audio);

            // STAGE 1: Broad Bass Shelf (200Hz)
            bassShelf = audioCtx.createBiquadFilter();
            bassShelf.type = "lowshelf";
            bassShelf.frequency.value = 200;
            bassShelf.gain.value = 0;

            // STAGE 2: Deep Bass Peak (55Hz) - This provides the "thump"
            bassPeak = audioCtx.createBiquadFilter();
            bassPeak.type = "peaking";
            bassPeak.frequency.value = 55;
            bassPeak.Q.value = 2.0; // High resonance for punchiness
            bassPeak.gain.value = 0;

            // STAGE 3: Volume
            gainNode = audioCtx.createGain();

            // STAGE 4: Safety Limiter (Prevents clipping from high bass)
            compressor = audioCtx.createDynamicsCompressor();
            compressor.threshold.setValueAtTime(-10, audioCtx.currentTime);
            compressor.knee.setValueAtTime(40, audioCtx.currentTime);
            compressor.ratio.setValueAtTime(12, audioCtx.currentTime);

            source.connect(bassShelf).connect(bassPeak).connect(gainNode).connect(compressor).connect(audioCtx.destination);

            audio.addEventListener('timeupdate', () => {
                const pct = (audio.currentTime / audio.duration) * 100;
                document.getElementById('progress-fill').style.width = pct + "%";
                
                // Visualization reaction to bass levels
                const bounce = 1 + (bassPeak.gain.value / 40) * 0.15;
                document.getElementById('viz-disk').style.transform = `scale(${bounce})`;
            });

            audio.onended = next;
        }

        function handleFiles(e) {
            const files = Array.from(e.target.files);
            playlist = playlist.concat(files);
            renderPlaylist();
            if(currentIndex === -1) playTrack(0);
        }

        function renderPlaylist() {
            const container = document.getElementById('playlist-container');
            container.innerHTML = playlist.map((f, i) => `
                <div class="song-item ${i === currentIndex ? 'active' : ''}" onclick="playTrack(${i})">
                    ${f.name}
                </div>
            `).join('');
        }

        function playTrack(i) {
            if(audioCtx.state === 'suspended') audioCtx.resume();
            currentIndex = i;
            const file = playlist[i];
            audio.src = URL.createObjectURL(file);
            document.getElementById('track-name').innerText = file.name.split('.')[0].toUpperCase();
            document.getElementById('play-btn').innerText = "||";
            audio.play();
            renderPlaylist();
        }

        function togglePlay() {
            if(!audio.src) return;
            if(audio.paused) { audio.play(); document.getElementById('play-btn').innerText = "||"; }
            else { audio.pause(); document.getElementById('play-btn').innerText = "▶"; }
        }

        function updateBass(v) {
            // Distribute boost across shelf and peak filters
            const shelfBoost = (v / 100) * 18;
            const peakBoost = (v / 100) * 22;
            bassShelf.gain.setTargetAtTime(shelfBoost, audioCtx.currentTime, 0.1);
            bassPeak.gain.setTargetAtTime(peakBoost, audioCtx.currentTime, 0.1);
            document.getElementById('bass-val').innerText = v + "%";
        }

        function updateVol(v) {
            gainNode.gain.setTargetAtTime(v/100, audioCtx.currentTime, 0.1);
            document.getElementById('vol-val').innerText = v + "%";
        }

        function seek(e) {
            if(!audio.duration) return;
            const rect = e.target.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const pct = x / rect.width;
            audio.currentTime = pct * audio.duration;
        }

        function next() { if(playlist.length) playTrack((currentIndex + 1) % playlist.length); }
        function prev() { if(playlist.length) playTrack((currentIndex - 1 + playlist.length) % playlist.length); }
    </script>
</body>
</html>
